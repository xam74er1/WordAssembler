
var wordInCache = []

$( function() {
    //done au mot de base la possiblite detre drag
    $(".word").draggable(
        {
            appendTo: 'body',
            helper: 'clone'
        }
    );

    //Permet la zone de drop avec un event au drop
    $("#addZone").droppable({

        activeClass: 'active',
        hoverClass: 'hover',
        accept: ":not(.ui-sortable-helper)", // Reject clones generated by sortable

        drop: function(event, ui) {
            //On crée un ellément equivallent
            var $el = $('<div class="drop-item"><summary>' + ui.draggable.text() + '</summary></div>');
            //On lui ajoute un bouton pour le suprime
            $el.append($('<button type="button" class="btn btn-default btn-xs remove"><span class="poubelle">Remove</span></button>').click(function () {
                $(this).parent().detach();

            }));
            $(this).append($el);

            var text = ui.draggable.text();
            //On ajoute a la liste
            //Peutre le reire en obj a locase
            wordInCache.push([text,$el]);
            verifie();
        },
        over: function(event, ui) {
            $(this).css('background', 'orange');
        },
        out: function(event, ui) {
            $(this).css('background', 'cyan');
        }
    });
} );

//Si on a au moins 2 mot vérifie dans le backend l'addition des mots
function verifie(){
    if(wordInCache.length>=2){

        let tmpPositive =[];
        for (let i =0;i<wordInCache.length;i++){
            tmpPositive.push(wordInCache[i][0]);
        }
        getCloseWord(tmpPositive,[])

  //On netoit tout
        $("#addZone").empty();
        $("#subZone").empty();
        $("#addZone").append("<div class=\"Title\">Add</div>");
        $("#subZone").append("<div class=\"Title\">Subtract</div>");
        wordInCache = []


    }
}

//Demende au backende de calcule les mot les plus proche de l'exprssion
// ex : demede closeWord("king-man+woman") il renvois queen
function getCloseWord(positive,negative) {
    var resultat;
    $.ajax({
        url: "/getCumstomeCloseWord" ,
        data: {
            "positive": JSON.stringify(positive),
            "negative":JSON.stringify(negative)
        },
        cache: false,
        type: "get",
        success: function(response) {
            console.log("------")
            console.log(response)
            if(response['word'][0]!=undefined&&response['word'][0].length>0){
                addWord(response['word'][0].trim())
                console.log("Add "+response['word'][0])
            }else{
                console.log("Not word add")
            }

            //cube.material.color.setHex(response)
            resultat = response;


        }
    });
    return resultat;
}
//Cette fonction permet d'ajoute un mot
function addWord(word){

    console.log($('#wordZone:contains("'+word+'")'))
    //Si let mot n'est pas deja present
    if($('#wordZone:contains("'+word+'")').length <= 0){

        //On cree un nouveau mot
        let motTmp = $('<div class="word">'+word+'</div>').draggable(
        {
            appendTo: 'body',
            helper: 'clone'
        })

        //on l'ajoute a la zone des mot
        $("#wordZone").append(motTmp)
    }

}